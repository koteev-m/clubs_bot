# Музыкальный модуль: инварианты и контракты

## Модели
- `music_items` хранит и треки, и DJ-сеты; тип фиксируется в `item_type` (`TRACK` или `SET`).
- Публикация управляется через `published_at`. Опубликованные элементы видны в гостевой ленте и микстейпах, черновики — только в админке.
- `music_assets` хранит бинарные файлы (аудио/обложки) с контрольной суммой SHA-256.

## Инварианты
- Гостевой API (`/api/music/sets`, микстейпы) возвращает только `item_type = SET` и `published_at != null`.
- Аудиофайл и обложка доступны только для опубликованных элементов. ETag основан на SHA-256.
- Загрузка файлов идёт потоково с ограничением размера:
  - аудио: до 50 MB;
  - обложка: до 5 MB.
- При загрузке проверяется `Content-Type`:
  - аудио: `audio/mpeg`, `audio/ogg`, `audio/mp4`, `audio/aac`;
  - обложки: `image/png`, `image/jpeg`, `image/webp`.
- Для клубных элементов требуется доступ администратора к клубу; глобальные элементы разрешены только для OWNER/GLOBAL_ADMIN.

## Рекомендации для клиентов
- Для публичных лент использовать `ETag` и `If-None-Match`.
- Для отображения аудио использовать `audioUrl` (внутренние ссылки), для внешних источников — `sourceUrl` (если поле заполнено).
