# --- Profile ---
APP_PROFILE=PROD
TELEGRAM_USE_POLLING=false

# --- Server / Networking ---
PORT=
TRUST_PROXY_HEADERS=true
BASE_URL=
WEBAPP_ORIGIN=

# CORS (через запятую, пробелы допустимы — триммируются). В PROD/STAGE обязательно задайте whitelist.
CORS_ALLOWED_ORIGINS=https://t.me, https://web.telegram.org
# Кэширование preflight-ответов (секунды). По умолчанию 600, допустимо 60–86400.
CORS_PREFLIGHT_MAX_AGE_SECONDS=600

# CSP для статического WebApp (/webapp/entry/*)
# По умолчанию выключен; включайте постепенно в report-only.
CSP_ENABLED=false
CSP_REPORT_ONLY=true
# Можно переопределить политику; иначе применяется безопасная «строгая» дефолтная.
# Не задаём frame-ancestors из-за Telegram WebView.
CSP_VALUE=default-src 'self'; img-src 'self' data: blob:; style-src 'self' 'unsafe-inline'; script-src 'self'; connect-src 'self' https://t.me https://telegram.org;
WEBAPP_CSP_PATH_PREFIX=/webapp/entry

# Rate limiting (subject path prefixes для Mini App API)
RL_IP_ENABLED=true
RL_IP_RPS=100
RL_IP_BURST=20
RL_SUBJECT_ENABLED=true
RL_SUBJECT_RPS=10.0
RL_SUBJECT_BURST=30.0
RL_SUBJECT_TTL_SECONDS=300
RL_RETRY_AFTER_SECONDS=2
RL_SUBJECT_PATH_PREFIXES=/api/clubs/

# HTTP request guards
HTTP_REQUEST_TIMEOUT_MS=3000
CHECKIN_MAX_BODY_BYTES=4096

# --- Database ---
# Для Docker Compose порт проброшен на 15432 (см. docker-compose.yml)
DATABASE_URL=
DATABASE_USER=
DATABASE_PASSWORD=

# --- Health ---
HEALTH_DB_TIMEOUT_MS=150

# --- Flyway (PG-only) ---
FLYWAY_ENABLED=true
FLYWAY_LOCATIONS=
FLYWAY_BASELINE_ON_MIGRATE=true
FLYWAY_MODE=
FLYWAY_OUT_OF_ORDER=false
# Legacy toggle: when true, forces validate-only mode (prefer FLYWAY_MODE=validate)
FLYWAY_VALIDATE_ONLY=false

# Кэширование статики WebApp (immutable)
# 60–31536000, по умолчанию 31536000 (1 год)
WEBAPP_ENTRY_CACHE_SECONDS=31536000

# --- Telegram bot ---
TELEGRAM_BOT_TOKEN=
# ДОЛЖЕН совпадать с TELEGRAM_BOT_TOKEN (для HMAC Mini App initData)
BOT_TOKEN=

# Секрет вебхука (32–64 символа, A-Za-z0-9_- как в Bot API)
TELEGRAM_WEBHOOK_SECRET=
# Для кода/плагина, который ожидает WEBHOOK_SECRET_TOKEN, дублируем:
WEBHOOK_SECRET_TOKEN=

# Фиксированный публичный путь (эндпоинт) вебхука
TELEGRAM_WEBHOOK_PUBLIC_PATH=

BOT_USERNAME=
OWNER_TELEGRAM_ID=
# Секрет для QR/OTT – длинная случайная строка/hex
QR_SECRET=
# Временная поддержка старого QR-секрета (для бесшовной ротации). Можно оставить пустым.
QR_OLD_SECRET=

ACME_EMAIL=

# --- Feature flags (plugins, routes, behavior) ---
RATE_LIMIT_ENABLED=true
HOT_PATH_ENABLED=true
RBAC_ENABLED=true
NOTIFY_ROUTES_ENABLED=true
NOTIFICATIONS_ENABLED=true
USE_NOTIFY_SENDER=true
OUTBOX_ADMIN_ENABLED=false

FINALIZE_ENABLED=true
CANCEL_ENABLED=true
REFUND_ENABLED=true

# --- Workers / RatePolicy ---
GLOBAL_RPS=25
CHAT_RPS=1.5
WORKER_PARALLELISM=4

# --- Local Bot API (optional) ---
LOCAL_BOT_API_ENABLED=false
# TELEGRAM_API_ID=
# TELEGRAM_API_HASH=
# LOCAL_BOT_API_URL=http://local_bot_api:8081/bot

# --- HQ (notify endpoints) ---
HQ_CHAT_ID=-
HQ_GENERAL_THREAD_ID=19
HQ_BOOKINGS_THREAD_ID=2
HQ_QA_THREAD_ID=6
HQ_LISTS_THREAD_ID=3
HQ_SYSTEM_THREAD_ID=4

# --- CLUB 1 (Mix) ---
CLUB1_CHAT_ID=-
CLUB1_GENERAL_THREAD_ID=1
CLUB1_BOOKINGS_THREAD_ID=2
CLUB1_LISTS_THREAD_ID=3
CLUB1_QA_THREAD_ID=4
CLUB1_MEDIA_THREAD_ID=5
CLUB1_SYSTEM_THREAD_ID=7

# --- CLUB 2 (Osobnyak) ---
CLUB2_CHAT_ID=-
CLUB2_GENERAL_THREAD_ID=1
CLUB2_BOOKINGS_THREAD_ID=2
CLUB2_LISTS_THREAD_ID=4
CLUB2_QA_THREAD_ID=5
CLUB2_MEDIA_THREAD_ID=6
CLUB2_SYSTEM_THREAD_ID=7

# --- CLUB 3 (internal name) ---
CLUB3_CHAT_ID=-
CLUB3_GENERAL_THREAD_ID=1
CLUB3_BOOKINGS_THREAD_ID=2
CLUB3_LISTS_THREAD_ID=3
CLUB3_QA_THREAD_ID=4
CLUB3_MEDIA_THREAD_ID=5
CLUB3_SYSTEM_THREAD_ID=6

# --- CLUB 4 (NN) ---
CLUB4_CHAT_ID=-
CLUB4_GENERAL_THREAD_ID=1
CLUB4_BOOKINGS_THREAD_ID=2
CLUB4_LISTS_THREAD_ID=3
CLUB4_QA_THREAD_ID=4
CLUB4_MEDIA_THREAD_ID=5
CLUB4_SYSTEM_THREAD_ID=6

# ------------------------------
# Hot Path limiter (20.1)
# ------------------------------
HOT_PATH_MAX_CONCURRENT=8
HOT_PATH_RETRY_AFTER_SEC=1
MAX_REQUEST_SIZE_BYTES=2097152

# ------------------------------
# One-Time Tokens (20.6)
# ------------------------------
OTT_TTL_SECONDS=300
OTT_MAX_ENTRIES=100000

# ------------------------------
# Hall render cache (20.4)
# ------------------------------
HALL_CACHE_MAX_ENTRIES=500
HALL_CACHE_TTL_SECONDS=60
HALL_BASE_IMAGE_VERSION=1

# ------------------------------
# Hikari / Tx tuning (20.2)
# ------------------------------
# --- Hikari pool ---
# Диапазоны и дефолты описаны в docs/dr.md.
# Оставьте пустым, чтобы использовать встроенные дефолты (локалка/dev).
HIKARI_MAX_POOL_SIZE=
HIKARI_MIN_IDLE=
HIKARI_CONN_TIMEOUT_MS=
HIKARI_VALIDATION_TIMEOUT_MS=
HIKARI_LEAK_DETECTION_MS=

# --- DB Tx tuning ---
DB_TX_MAX_RETRIES=3
DB_TX_BASE_BACKOFF_MS=500
DB_TX_MAX_BACKOFF_MS=15000
DB_TX_JITTER_MS=100
DB_SLOW_QUERY_MS=200

# ------------------------------
# Payments: Refund Provider & Worker
# ------------------------------
REFUND_WORKER_ENABLED=true
REFUND_PROVIDER_URL=
REFUND_PROVIDER_API_KEY=
REFUND_MAX_ATTEMPTS=
REFUND_BASE_BACKOFF_MS=
REFUND_MAX_BACKOFF_MS=
REFUND_JITTER_MS=

# ------------------------------
# Observability / Tracing (optional)
# ------------------------------
TRACING_ENABLED=false
OTEL_SERVICE_NAME=
OTEL_EXPORTER_OTLP_ENDPOINT=
# METRICS_PROMETHEUS_ENABLED=true
# METRICS_PATH=/metrics
